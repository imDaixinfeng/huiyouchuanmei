<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>汇友传媒</title>
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>

	<body>

		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" data-id="home">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" id="1" data-id="task_center">
				<span class="mui-icon mui-icon-list"></span>
				<span class="mui-tab-label">任务大厅</span>
			</a>
			<a class="mui-tab-item" id="2" data-id="user_center">
				<span class="mui-icon mui-icon-person"></span>
				<span class="mui-tab-label">个人中心</span>
			</a>
		</nav>

		<script src="js/mui.min.js"></script>
		<script src="js/util.js"></script>
		<script type="text/javascript">
			(function() {
				mui.init({
					swipeBack: true //启用右滑关闭功能
				});

				mui.plusReady(function() {
					//要切换的子页面
					/* var subpages = [
						'home.html',
						'task_center.html',
						'user_center.html'
					]; */
					/* //设置默认打开首页显示的子页序号
					var Index = 0;
					//把子页面路径写在数组里面
					//var subpages = ['home.html', 'hotspot.html', 'experience.html', 'news.html', 'mine.html']
					//获取当前页面所属的Webview窗口对象
					var self = plus.webview.currentWebview();
					for (var i = 0; i < 5; i++) {
						//创建webview子页
						var sub = plus.webview.create(
							subpages[i], //子页url
							subpages[i], //子页id
							{
								top: '0px',
								bottom: '44px',
								scrollIndicator: "none" //隐藏滚动条
							}
						);
						//如果不是我们设置的子页就隐藏
						if (i != Index) {
							sub.hide()
						}
						//将webview对象填充到窗口
						self.append(sub)
					}

					//当前激活选项
					var activeTab = subpages[Index]
					var targetTab;
					mui('.mui-bar-tab').on('tap', 'a', function(e) {
						//获取子页面的id
						var j = this.getAttribute('id')
						targetTab = subpages[j]
						if (activeTab == targetTab) {
							return
						}
						//显示目标选项卡
						plus.webview.show(targetTab)
						//隐藏当前选项卡
						plus.webview.hide(activeTab)
						//更改当前活跃选项卡
						activeTab = targetTab
					}) */
					var subPages = [{
						url: 'home.html',
						id: 'home'
					}, {
						url: 'task_center.html',
						id: 'task_center',
					}, {
						url: 'user_center.html',
						id: 'user_center'
					}];
					var subStyles = {
						top: '0px',
						bottom: '51px'
					};

					var aniShow = {};
					var _selfWv = plus.webview.currentWebview();
					var _secondWv = plus.webview.getSecondWebview();
					_selfWv.append(_secondWv);
					//当前激活选项
					var activeTab = subPages[0].id;
					var getSubInfoById = function(infoList, id) {
						var result = null;
						for (var i = 0, len = infoList.length; i < len; i++) {
							var _info = infoList[i];
							if (_info.id === id) {
								result = _info;
								break;
							}
						}
						return result;
					};
					//选项卡点击事件
					mui('.mui-bar-tab').on('tap', 'a', function(e) {
						var targetTab = this.getAttribute('data-id');

						if (targetTab == activeTab) {
							return;
						}
						//显示目标选项卡
						//若为iOS平台或非首次显示，则直接显示
						var _subWv = plus.webview.getWebviewById(targetTab);
						if (!_subWv) {
							var _subInfo = getSubInfoById(subPages, targetTab);
							_subWv = plus.webview.create(_subInfo.url, _subInfo.id, subStyles);
							_selfWv.append(_subWv);
						}
						if (mui.os.ios || aniShow[targetTab]) {
							_subWv.show();
						} else {
							//否则，使用fade-in动画，且保存变量
							var temp = {};
							temp[targetTab] = "true";
							mui.extend(aniShow, temp);
							_subWv.show(
							"fade-in", 300);
						}
						//隐藏当前;
						plus.webview.hide(activeTab);
						//更改当前活跃的选项卡
						activeTab = targetTab;
					});
				});

			})();
		</script>


	</body>

</html>
